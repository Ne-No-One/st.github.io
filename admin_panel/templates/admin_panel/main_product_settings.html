{% extends 'admin_panel/base.html' %}

{% block title %}Головний товар - Адмін Панель{% endblock %}
{% block page_title %}Головний товар - Повне управління{% endblock %}

{% block content %}
<div class="row">
    <!-- Варіанти кольорів -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-palette me-2"></i>
                    Варіанти кольорів ({{ variants|length }})
                </h5>
                <button class="btn btn-sm btn-success" onclick="toggleAddColorForm()">
                    <i class="fas fa-plus me-1"></i>
                    Додати колір
                </button>
            </div>
            
            <!-- Форма додавання кольору -->
            <div class="card-body border-bottom" id="addColorForm" style="display: none;">
                <form method="post" class="bg-light p-3 rounded">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_variant">
                    <h6 class="mb-3">
                        <i class="fas fa-plus me-2"></i>
                        Додати новий колір
                    </h6>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="variant_name" class="form-label">Назва кольору</label>
                            <input type="text" class="form-control" id="variant_name" name="variant_name" 
                                   placeholder="Наприклад: Червоний" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="hex_code" class="form-label">Hex код</label>
                            <input type="text" class="form-control" id="hex_code" name="hex_code" 
                                   placeholder="#ff0000" pattern="^#[0-9A-Fa-f]{6}$" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="image_url" class="form-label">URL зображення</label>
                            <input type="url" class="form-control" id="image_url" name="image_url" 
                                   placeholder="https://example.com/image.jpg" required>
                        </div>
                        <div class="col-md-1 mb-3">
                            <label for="variant_order" class="form-label">Порядок</label>
                            <input type="number" class="form-control" id="variant_order" name="variant_order" 
                                   placeholder="1" min="1" max="100" value="1">
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-1"></i>
                            Зберегти колір
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="toggleAddColorForm()">
                            Скасувати
                        </button>
                    </div>
                </form>
                    </div>
                    
            <div class="card-body">
                {% if variants %}
                    <div class="row">
                        {% for variant in variants %}
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 border">
                                <div class="position-relative">
                                    {% if variant.image_url %}
                                        <img src="{{ variant.image_url }}" alt="{{ variant.name }}" 
                                             class="card-img-top" style="height: 200px; width: 150px; object-fit: cover; margin: 0 auto; display: block;">
                                    {% else %}
                                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" 
                                             style="height: 200px; width: 150px; margin: 0 auto;">
                                            <i class="fas fa-image fa-2x text-muted"></i>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="position-absolute top-0 start-0 m-2">
                                        <span class="badge" style="background-color: {{ variant.hex_code }}; color: white; text-shadow: 1px 1px 1px rgba(0,0,0,0.5);">
                                            {{ variant.hex_code }}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1">{{ variant.name }}</h6>
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="color-preview me-1" style="background-color: {{ variant.hex_code }}; width: 15px; height: 15px; border-radius: 50%; border: 1px solid #ccc;"></span>
                                        <code class="small">{{ variant.hex_code }}</code>
                                    </div>
                                    <div class="d-flex gap-1 mb-2">
                                        <span class="badge bg-info">ID: {{ variant.id }}</span>
                                        <span class="badge bg-secondary">Порядок: {{ variant.order|default:"1" }}</span>
                                    </div>
                                    
                                    <div class="btn-group w-100">
                                        <a href="{% url 'admin_panel:edit_color_variant' variant.id %}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="{% url 'admin_panel:delete_color_from_main' variant.id %}" 
                                           class="btn btn-sm btn-outline-danger" 
                                           onclick="return confirm('Видалити {{ variant.name }}?')">
                                            <i class="fas fa-trash"></i>
                                        </a>
                            </div>
                        </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-palette fa-2x text-muted mb-2"></i>
                        <h6 class="text-muted">Варіанти кольорів не додані</h6>
                        <button class="btn btn-success btn-sm" onclick="toggleAddColorForm()">
                            <i class="fas fa-plus me-1"></i>
                            Додати перший колір
                        </button>
                    </div>
                {% endif %}
            </div>
            </div>
        </div>
    </div>
    
<!-- Варіанти кількості та ціни -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-calculator me-2"></i>
                    Варіанти кількості та ціни ({{ quantities|length }})
                </h5>
                <button class="btn btn-sm btn-success" onclick="toggleAddQuantityForm()">
                    <i class="fas fa-plus me-1"></i>
                    Додати варіант
                </button>
            </div>
            
            <!-- Форма додавання кількості -->
            <div class="card-body border-bottom" id="addQuantityForm" style="display: none;">
                <form method="post" class="bg-light p-3 rounded">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="add_quantity">
                    <h6 class="mb-3">
                        <i class="fas fa-plus me-2"></i>
                        Додати варіант кількості
                    </h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="quantity" class="form-label">Кількість</label>
                            <input type="number" class="form-control" id="quantity" name="quantity" 
                                   placeholder="21" min="1" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="price_per_unit" class="form-label">Ціна за одиницю (грн)</label>
                            <input type="number" class="form-control" id="price_per_unit" name="price_per_unit" 
                                   placeholder="0.50" step="0.01" min="0" required>
                        </div>
                        <div class="col-md-2 mb-3">
                            <label for="quantity_order" class="form-label">Порядок</label>
                            <input type="number" class="form-control" id="quantity_order" name="quantity_order" 
                                   placeholder="1" min="1" max="100" value="1">
                        </div>
        </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-1"></i>
                            Зберегти варіант
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="toggleAddQuantityForm()">
                            Скасувати
                        </button>
                    </div>
                </form>
        </div>
        
            <div class="card-body">
                {% if quantities %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Кількість (шт)</th>
                                    <th>Ціна за одиницю</th>
                                    <th>Загальна ціна</th>
                                    <th>Порядок</th>
                                    <th>Статус</th>
                                    <th>Дії</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for qty in quantities %}
                                <tr>
                                    <td>
                                        <span class="badge bg-info">{{ qty.id }}</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-primary fs-6">{{ qty.quantity }}</span>
                                    </td>
                                    <td>
                                        <strong>{{ qty.price_per_unit }} грн</strong>
                                    </td>
                                    <td>
                                        {% widthratio qty.price_per_unit 1 qty.quantity as total_price %}
                                        <span class="text-success fw-bold">{{ total_price }} грн</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ qty.order|default:"1" }}</span>
                                    </td>
                                    <td>
                                        {% if qty.is_active %}
                        <span class="badge bg-success">Активний</span>
                    {% else %}
                        <span class="badge bg-secondary">Неактивний</span>
                    {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <a href="{% url 'admin_panel:edit_quantity_variant' qty.id %}" 
                                               class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{% url 'admin_panel:delete_quantity_option' qty.id %}" 
                                               class="btn btn-sm btn-outline-danger" 
                                               onclick="return confirm('Видалити варіант {{ qty.quantity }} шт?')">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-calculator fa-2x text-muted mb-2"></i>
                        <h6 class="text-muted">Варіанти кількості не додані</h6>
                        <p class="text-muted small">Додайте варіанти кількості з цінами за одиницю</p>
                        <button class="btn btn-success" onclick="toggleAddQuantityForm()">
                            <i class="fas fa-plus me-2"></i>
                            Додати перший варіант
                        </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Функції для роботи з формами
function toggleAddColorForm() {
    const form = document.getElementById('addColorForm');
    if (form.style.display === 'none') {
        form.style.display = 'block';
        // Скрол до форми
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } else {
        form.style.display = 'none';
        // Очищуємо форму
        const inputs = form.querySelectorAll('input[type="text"], input[type="url"]');
        inputs.forEach(input => input.value = '');
    }
}

function toggleAddQuantityForm() {
    const form = document.getElementById('addQuantityForm');
    if (form.style.display === 'none') {
        form.style.display = 'block';
        // Скрол до форми
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } else {
        form.style.display = 'none';
        // Очищуємо форму
        const inputs = form.querySelectorAll('input[type="number"]');
        inputs.forEach(input => input.value = '');
    }
}
</script>
{% endblock %}