#!/usr/bin/env python
"""
–ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç—É Django –ø—Ä–æ–µ–∫—Ç—É
–°—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫—É –ø–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç—É –∫–≤—ñ—Ç–∫–æ–≤–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω—É
"""

import os
import sys
import django
from django.conf import settings
from django.core.management import execute_from_command_line
import webbrowser
import threading
import time

def setup_django():
    """–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Django –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç—É"""
    # –î–æ–¥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–æ Python path
    current_dir = os.path.dirname(os.path.abspath(__file__))
    if current_dir not in sys.path:
        sys.path.insert(0, current_dir)
    
    # –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ Django
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'mysite.settings')
    django.setup()
    
    return settings

def open_browser_delay():
    """–í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –±—Ä–∞—É–∑–µ—Ä –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é"""
    time.sleep(3)  # –ß–µ–∫–∞—î–º–æ 3 —Å–µ–∫—É–Ω–¥–∏
    try:
        webbrowser.open('http://127.0.0.1:8000/')
        print("üåê –û—Å–Ω–æ–≤–Ω–∏–π —Å–∞–π—Ç –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –≤ –±—Ä–∞—É–∑–µ—Ä—ñ!")
    except Exception as e:
        print(f"‚ö†Ô∏è  –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –±—Ä–∞—É–∑–µ—Ä: {e}")
        print("üì± –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤—Ä—É—á–Ω—É: http://127.0.0.1:8000/")

def main():
    """–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–∞–ø—É—Å–∫—É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç—É"""
    print("üå∏ –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç—É –∫–≤—ñ—Ç–∫–æ–≤–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω—É...")
    print("=" * 60)
    
    try:
        # –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ Django
        settings = setup_django()
        print("‚úÖ Django –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ")
        
        # –°—Ç–≤–æ—Ä—é—î–º–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è —Å–µ—Å—ñ–π
        sessions_dir = os.path.join(os.path.dirname(__file__), 'sessions')
        if not os.path.exists(sessions_dir):
            os.makedirs(sessions_dir)
            print("‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è —Å–µ—Å—ñ–π —Å—Ç–≤–æ—Ä–µ–Ω–∞")
        
        print("\nüìä –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∑–∞–ø—É—Å–∫:")
        print(f"   ‚Ä¢ –ü–æ—Ä—Ç: 8000")
        print(f"   ‚Ä¢ –ê–¥—Ä–µ—Å–∞: http://127.0.0.1:8000/")
        print(f"   ‚Ä¢ –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å: http://127.0.0.1:8000/admin-panel/")
        print(f"   ‚Ä¢ –†–µ–∂–∏–º: DEBUG = {settings.DEBUG}")
        print(f"   ‚Ä¢ –•–æ—Å—Ç–∏: {settings.ALLOWED_HOSTS}")
        
        print("\nüéØ –î–æ—Å—Ç—É–ø–Ω—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Å–∞–π—Ç—É:")
        print("   ‚Ä¢ üè† –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ - –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä—ñ–≤")
        print("   ‚Ä¢ üõçÔ∏è  –ü–æ—Å–ª—É–≥–∏ - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ—Å–ª—É–≥–∏")
        print("   ‚Ä¢ ‚ÑπÔ∏è  –ü—Ä–æ –Ω–∞—Å - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–º–ø–∞–Ω—ñ—é")
        print("   ‚Ä¢ üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ - —Ñ–æ—Ä–º–∞ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É")
        print("   ‚Ä¢ ‚öôÔ∏è  –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å - —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∞–π—Ç–æ–º")
        
        print("\n" + "=" * 60)
        print("üîÑ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞...")
        
        # –ó–∞–ø—É—Å–∫–∞—î–º–æ –±—Ä–∞—É–∑–µ—Ä –≤ –æ–∫—Ä–µ–º–æ–º—É –ø–æ—Ç–æ—Ü—ñ
        browser_thread = threading.Thread(target=open_browser_delay)
        browser_thread.daemon = True
        browser_thread.start()
        
        # –ó–∞–ø—É—Å–∫–∞—î–º–æ Django —Å–µ—Ä–≤–µ—Ä
        execute_from_command_line(['manage.py', 'runserver', '127.0.0.1:8000'])
        
    except KeyboardInterrupt:
        print("\n\n‚èπÔ∏è  –°–µ—Ä–≤–µ—Ä –∑—É–ø–∏–Ω–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º")
        print("üëã –î–æ –ø–æ–±–∞—á–µ–Ω–Ω—è!")
    except Exception as e:
        print(f"\n‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É: {e}")
        print("\nüîß –ú–æ–∂–ª–∏–≤—ñ —Ä—ñ—à–µ–Ω–Ω—è:")
        print("   ‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –≤—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ: pip install -r requirements.txt")
        print("   ‚Ä¢ –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ –≤–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É")
        print("   ‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –Ω–µ–º–∞—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –∑ —ñ–Ω—à–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –Ω–∞ –ø–æ—Ä—Ç—É 8000")
        print("   ‚Ä¢ –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–æ")
        sys.exit(1)

if __name__ == '__main__':
    main()
